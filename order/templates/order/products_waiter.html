<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesero</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@1,700&display=swap" rel="stylesheet">
    <style type="text/css">
        #body {
            text-align: center;
            background-color: black;
            width: 100%;
            height: 100%;
            color: white;
            font-family: 'Ubuntu', sans-serif;
        }

        #devolverse {
            width: 50%;
            height: 1%;
            color: white;
            background-color: #FCB13B;
            border: none;
            border-radius: 1rem;
            cursor: pointer;
        }

        #pedido {
            border-radius: 5rem;
            height: 3rem;
            width: 3rem;
        }

        #nav {
            display: flex;
            align-items: center;
            justify-content: space-around;
        }

        #comandar {
            border: none;
        }
    </style>
</head>

<body>
    <div id="body">
        <h1>System SJD</h1>
        <p>{{request.user.email}}</p>
        <div id="nav">
            <i class='bx bx-copy-alt' style="font-size: 4rem; cursor: pointer;"></i>
        </div>
        <br>
        <a href="{% url 'order_new'%}"><button id="devolverse"></button></a><br><br>
        <button id="comandar">Comandar</button>
        <p id="orderTotal">0</p>
        <br><br>
        {% for product in all_products %}
        <div class="col-12">
            <div class="card" style="border-radius: 5rem;">
                <div class="card-body">
                    <img class="card-img-bottom" src="{{product.img_route.url}}" style="width:7rem; height:7rem;">
                    <h5 class="card-title" style="color:black">{{product.name}}</h5>
                    <p class="card-text" style="color: black">{{product.description}}</p>
                    <p class="card-text" style="color:#85bb65">${{product.price}}</p>
                    <i class='bx bx-minus' style="color:black"></i>
                    '0'
                    <i class='bx bx-plus' style="color:black" onclick="addToCar({{product.id}},{{product.price}})"></i>
                </div>
            </div>
        </div><br>
        {% endfor%}
        <br><br>
    </div>
</body>
<script>
    window.addEventListener("load", (e)=>{
        const table_number = localStorage.getItem("table_number");
        console.log(table_number);
        document.getElementById("devolverse").innerText="Mesa " + table_number;
    });
    class Product {
        constructor(itemId, price){
            this.itemId=itemId;
            this.price=price;
        }
    }
    class ShoppingCar{
        constructor(){
            this.products=[];
            this.total=0;
        }
        addProduct(Product){
            this.products.push(Product);
            this.total+=Product.price;
            this.updateOrderTotal();
        }
        updateOrderTotal(){
            let shoppingTotal = document.getElementById("orderTotal");
            this.products.forEach((product)=>{
                console.log(product.itemId);
            });
            shoppingTotal.innerText=this.total;
        }
        sendDataOrder(){
            console.log(JSON.stringify(this.products))
            fetch("{% url 'products_waiter'%}",{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:  JSON.stringify({'products': this.products}),
            }).then(response=>response.json()).then(data=>console.log(data))
        }
    }
    let car = new ShoppingCar();
    let addToCar =( itemId,price)=>{
        let product = new Product(itemId=itemId,price=price);
        car.addProduct(product);
    }
    let btnSendData = document.getElementById("comandar");
    btnSendData.addEventListener("click",e=>{
        e.preventDefault()
        car.sendDataOrder();
    })
</script>
</html>